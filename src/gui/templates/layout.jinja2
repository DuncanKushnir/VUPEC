<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8"/>
    <title>VUPEC</title>
    <meta name="theme-color" content="#5eb9d7"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>

<header>
    <div class="contentheader">
    <div class="title_area">
        <h2 id="main_title">VUPEC: Vehicle Use Phase Energy Calculator - Basic Interface</h2>
    </div>
    </div>
</header>

<!-- Fixed size after header-->
<form method="POST" action="/submit" id="parameter_form">
<div class="content">
    <!-- Always on top. Fixed position, fixed width, relative to content width-->
    <div class="sidebar_left">
        <div class="leftwrapper">
            {% block setup_subform %}{% endblock %}
        </div>
    </div>
    <div class="sidebar_right">
        <div class="rightwrapper">
            {% block result_subform %}{% endblock %}
        </div>
    </div>

    <!-- Scrollable div with main content -->
    <div class="scrollable_parameters">

        <div class="generic_spacing">
            <div class="form_wrapper">
                {% block physical_subform %}{% endblock %}
            </div>
        </div>

        <div class="generic_spacing">
            <div class="form_wrapper">
                {% block drivetrain_subform %}{% endblock %}
            </div>
        </div>

        <div class="generic_spacing">
            <div class="form_wrapper">
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
                this shit can be scrolled indefinitely</br>
            </div>
        </div>
    </div>
</div>
</form>


<footer>
    <div class="contentfooter">
    <div class="generic_area">
        <h2 id="footer_text">Funded by  <a href="http://www.energimyndigheten.se/" target="_blank">
        EnergiMyndigheten </a> as part of ERA-NET cofunding for EU HORIZON 2020.</h2>
    </div>
    </div>
</footer>

</body>

</html>

<script>
    // Global access to elements
    let manufacturer_select = document.getElementById('manufacturer');
    let model_select = document.getElementById('model');
    let drivecycle_select = document.getElementById('drivecycle');

    // Do stuff
    function lookup_models() {
        let manufacturer = manufacturer_select.value;
        fetch('/data/models_by_manufacturer/' + manufacturer)
            .then(function(response) {
                response.json()
                    .then(function(data) {
                        let option_html = '';
                        for (let model of data) {
                            option_html += '<option value="' + model.id + '">' + model.id + '</option>';
                        }
                        model_select.innerHTML = option_html;
                    });

            });
    }

    function change_drivecycle_image() {
        let drivecycle = drivecycle_select.value;
        fetch('/data/dc/' + drivecycle)
            .then(function(response) {
                response.json()
                    .then(function (data) {
                        document.getElementById("dc_image").src=data.src;
                    });
            });
    }

    function fill_base_values(){
        let manufacturer = manufacturer_select.value;
        let model = model_select.value;
        let drivecycle = drivecycle_select.value;
        fetch('/data/getbase/' + manufacturer + '/' + model + '/' + drivecycle)
            .then(function(response) {
                response.json()
                    .then(function (data) {
                        // Fill from database
                        for (var key in data.data) {
                            if (data.data.hasOwnProperty(key)) {
                                let element = document.getElementById(key);
                                //console.log(key+': '+data.data[key]);
                                if (element!=null) {
                                    element.innerHTML = data.data[key];
                                }

                            }
                        }
                        // clear set values
                        for (var key in data.orig) {
                            if (data.orig.hasOwnProperty(key)) {
                                let element = document.getElementById(key);
                                //console.log(key + ': ' + data.orig[key]);
                                if (element != null) {
                                    element.value = '';
                                }

                            }
                        }
                    })
            });
    }

    // State change triggers
    drivecycle_select.onchange = function () {
        change_drivecycle_image();
        fill_base_values();
    };

    manufacturer_select.onchange = function () {
        lookup_models();
        fill_base_values();
    };

    model_select.onchange = function () {
        fill_base_values();
    };

    window.onload = function () {
        lookup_models();
        change_drivecycle_image();
        fill_base_values();
    };


</script>
